FROM dockyardaws.cloud.capitalone.com/tompscanlan/packerd
ENV http_proxy
ENV https_proxy
ENV DEBIAN_FRONTEND noninteractive

RUN dpkg-divert --local --rename --add /sbin/initctl ; \
 ln -sf /bin/true /sbin/initctl ; \
 apt-get update ; \
 apt-get install -y sudo openssh-server curl lsb-release ; \
 if ! getent passwd kitchen; then                 useradd -d /home/kitchen -m -s /bin/bash kitchen;               fi ; \
 echo kitchen:kitchen | chpasswd ; \
 echo 'kitchen ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers ; \
 mkdir -p /etc/sudoers.d ; \
 echo 'kitchen ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers.d/kitchen ; \
 chmod 0440 /etc/sudoers.d/kitchen ; \
 mkdir -p /home/kitchen/.ssh ; \
 echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDPis6bdJlL43RwdxvTBLID0sa/wee9Vw5LQth3exDE7kKBdP+yBwJSB/qzT11yKT9ATIyOfPTfrEyCv6ubPKTSGGR3ggE6FfEYHtdacbC90WxckgPan9ladOeL8moIMumK/Yh2gUlGGaNXarchnF4uzNoBJ3eZl2o9LRXdqm9M2KhMOk5pxvitLmx+S9dB65H2qY1nRqSppfsyclJj9WDsoCbftWdo4px82JNTDe9S9WBsL6LUYgbfzWqYaYo0aciwtM+4AZAZT0/eueFZ/EWsyOOUCI29eV0weSJfCv+b/5oOTSK24RK+10O89eMWHsCH4a0d+imDocWNwLjLA9Xp kitchen_docker_key' >> /home/kitchen/.ssh/authorized_keys ;
